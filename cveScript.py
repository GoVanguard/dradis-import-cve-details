import json
from json import dumps
import requests
from requests import Session
from sys import argv, exit, version
from argparse import ArgumentParser
import time
import datetime
import re

class cveScript(object):
    def __init__(self):
        self.arg = self.parse_args()
        if len(argv) != 4:
            print("wrong argument amount. see HELP")
            exit(-6)
        self._headers = {}
        self.title_column = 0      # 'title' column  in csv required for all exports
        self.node_name_column = 0  # 'node_name' column in csv required for both nodes exports
        self.issue_id_column = 0   # 'issue_id' column in csv required for nodes w/evidence exports
        # Dradis API Configuration
        self.verify_cert = True    # change this to make requests without verifying
        self.dradis_api_token = self.arg.dradis_api_token
        self.dradis_project_id = self.arg.dradis_project_id
        self.dradis_url = self.arg.dradis_url
        self.dradis_issues_url = '{0}/pro/api/issues/'.format(self.dradis_url)
        self.dradis_nodes_url = '{0}/pro/api/nodes/'.format(self.dradis_url)
        self.session = Session()
        self.session.headers.update({'Authorization': 'Token token="{0}"'.format(self.dradis_api_token)})
        self.session.headers.update({'Dradis-Project-Id': self.dradis_project_id})
        self.session.headers.update({'Content-type': 'application/json'})
    
    def run(self):
        try:
            self.appendCveNum()
        except Exception as e:
            print('Failed in run: {0}'.format(e))
            exit(-1)
        self.session.close()
        return 0

    def appendCvss(self, newCveSite, issuetitle):
        issue_title = issuetitle
        cvss = ''
        cvssFieldPattern = re.compile(r'CVSS Score</th>')
        cvssPattern = re.compile(r'\d+\.\d+')
        # Getting CVSS from cvedetails website via generic HTTP GET request
        cvssReq = requests.get(newCveSite)

        # Converting response body into a string
        responseBody = str(cvssReq.text)

        # Searching response body (string version) to see if it has a CVSS score
        fieldMatch = re.search(cvssFieldPattern, responseBody)
        if fieldMatch:
            print("\nFound CVSS field on cvedetails...\n")
            z = fieldMatch.start()
            a = fieldMatch.end()
            b = fieldMatch.end() + 100
            match1 = re.search(cvssPattern, fieldMatch.string[a:b])
            if match1:
                e = match1.start()
                f = match1.end()
                cvss = match1.string[e:f]
            else:
                cvss = "N/A"
                print("\nCould not append CVSS score from cvedetails site for the following issue:" + issue_title)
        else:
            print("\nCould not append CVSS score from cvedetails site for the following issue:" + issue_title)

        try:
            return float(cvss)
        except:
            return 0.0

    def appendComplexity(self, newCveSite, issuetitle):
        issue_title = issuetitle
        complexity = ''
        complexityFieldPattern = re.compile(r'Access Complexity</th>')
        complexityLow = re.compile(r'Low')
        complexityMed = re.compile(r'Medium')
        complexityHigh = re.compile(r'High')

        # Getting Access Complexity field from cvssdetails website via generic HTTP GET request
        req = requests.get(newCveSite)

        # Converting response body into a string
        responseBody = str(req.text)

        # Searching response body (string version)
        fieldMatch = re.search(complexityFieldPattern, responseBody)
        if fieldMatch:
            print("\nFound Access Complexity field on cvedetails...\n")
            a = fieldMatch.end()
            b = fieldMatch.end() + 45
            match1 = re.search(complexityLow, fieldMatch.string[a:b])
            match2 = re.search(complexityMed, fieldMatch.string[a:b])
            match3 = re.search(complexityHigh, fieldMatch.string[a:b])
            if match1:
                complexity = "Low (Specialized access conditions or extenuating circumstances do not exist. Very little knowledge or skill is required to exploit.)"
            elif match2:
                complexity = "Medium (The access conditions are somewhat specialized. Some preconditions must be satisfied to exploit.)"
            elif match3:
                complexity = "High (Specialized access conditions exist. It is hard to exploit and several special conditions must be satisfied to exploit.)"
            else:
                print("\nCould not append Access Complexity from cvedetails site for the following issue: " + issue_title)
                complexity = "N/A"
        else:
            print("\nCould not append Access Complexity from cvedetails site for the following issue: " + issue_title)

        return complexity

    def appendImpact(self, newCveSite, issuetitle):
        issue_title = issuetitle
        impact = ''
        impactFieldPattern = re.compile(r'Confidentiality Impact</th>')
        impactNone = re.compile(r'None')
        impactPartial = re.compile(r'Partial')
        impactComplete = re.compile(r'Complete')

        # Getting Access Complexity field from cvssdetails website via generic HTTP GET request
        req = requests.get(newCveSite)

        # Converting response body into a string
        responseBody = str(req.text)

        # Searching response body (string version)
        fieldMatch = re.search(impactFieldPattern, responseBody)
        if fieldMatch:
            print("\nFound Confidentiality Impact on cvedetails...\n")
            a = fieldMatch.end()
            b = fieldMatch.end() + 55
            match1 = re.search(impactNone, fieldMatch.string[a:b])
            match2 = re.search(impactPartial, fieldMatch.string[a:b])
            match3 = re.search(impactComplete, fieldMatch.string[a:b])
            if match1:
                impact = "None (There is no impact to the confidentiality of the system.)"
            elif match2:
                impact = "Partial (There is considerable informational disclosure.)"
            elif match3:
                impact = "Complete (There is total information disclosure, resulting in all system files being revealed.)"
            else:
                print("\nCould not append Confidentiality Impact from cvedetails site for the following issue: " + issue_title)
                impact = "N/A"
        else:
            print("\nCould not append Access Complexity from cvedetails site for the following issue: " + issue_title)

        return impact

    def appendIntegrity(self, newCveSite, issuetitle):
        issue_title = issuetitle
        integrity = ''
        integrityFieldPattern = re.compile(r'Integrity Impact</th>')
        integrityNone = re.compile(r'None')
        integrityPartial = re.compile(r'Partial')
        integrityComplete = re.compile(r'Complete')

        # Getting Integrity Impact field from cvssdetails website via generic HTTP GET request
        req = requests.get(newCveSite)

        # Converting response body into a string
        responseBody = str(req.text)

        # Searching response body (string version)
        fieldMatch = re.search(integrityFieldPattern, responseBody)
        if fieldMatch:
            print("\nFound Integrity Impact on cvedetails...\n")
            a = fieldMatch.end()
            b = fieldMatch.end() + 50
            match1 = re.search(integrityNone, fieldMatch.string[a:b])
            match2 = re.search(integrityPartial, fieldMatch.string[a:b])
            match3 = re.search(integrityComplete, fieldMatch.string[a:b])
            if match1:
                integrity = "None (There is no impact to the integrity of the system.)"
            elif match2:
                integrity = "Partial (Modification of some system files or information is possible, but the attacker does not have control over what can be modified, or the scope of what the attacker can affect is limited.)"
            elif match3:
                integrity = "Complete (There is a total compromise of system integrity. There is a complete loss of system protection, resulting in the entire system being compromised.)"
            else:
                print("\nCould not append Integrity Impact from cvedetails site for the following issue: " + issue_title)
                integrity = "N/A"
        else:
            print("\nCould not append Integrity Impact from cvedetails site for the following issue: " + issue_title)

        return integrity

    def appendAvailability(self, newCveSite, issuetitle):
        issue_title = issuetitle
        availability = ''
        availabilityFieldPattern = re.compile(r'Availability Impact</th>')
        availabilityNone = re.compile(r'None')
        availabilityPartial = re.compile(r'Partial')
        availabilityComplete = re.compile(r'Complete')

        # Getting Integrity Impact field from cvssdetails website via generic HTTP GET request
        req = requests.get(newCveSite)

        # Converting response body into a string
        responseBody = str(req.text)

        # Searching response body (string version)
        fieldMatch = re.search(availabilityFieldPattern, responseBody)
        if fieldMatch:
            print("\nFound Availability Impact on cvedetails...\n")
            a = fieldMatch.end()
            b = fieldMatch.end() + 50
            match1 = re.search(availabilityNone, fieldMatch.string[a:b])
            match2 = re.search(availabilityPartial, fieldMatch.string[a:b])
            match3 = re.search(availabilityComplete, fieldMatch.string[a:b])
            if match1:
                availability = "None (There is no impact to the availability of the system.)"
            elif match2:
                availability = "Partial (There is reduced performance or interruptions in resource availability.)"
            elif match3:
                availability = "Complete (There is a total shutdown of the affected resource. The attacker can render the resource completely unavailable.)"
            else:
                print("\nCould not append Availability Impact from cvedetails site for the following issue: " + issue_title)
                availability = "N/A"
        else:
            print("\nCould not append Availability Impact from cvedetails site for the following issue: " + issue_title)

        return availability

    def appendAuthentication(self, newCveSite, issuetitle):
        issue_title = issuetitle
        authentication = ''
        authenticationFieldPattern = re.compile(r'Authentication</th>')
        authenticationNotRequired = re.compile(r'not required')
        authenticationRequired = re.compile(r'required')

        # Getting Authentication field from cvssdetails website via generic HTTP GET request
        req = requests.get(newCveSite)

        # Converting response body into a string
        responseBody = str(req.text)

        # Searching response body (string version)
        fieldMatch = re.search(authenticationFieldPattern, responseBody)
        if fieldMatch:
            print("\nFound authentication field on cvedetails...\n")
            a = fieldMatch.end()
            b = fieldMatch.end() + 50
            match1 = re.search(authenticationNotRequired, fieldMatch.string[a:b].lower())
            match2 = re.search(authenticationRequired, fieldMatch.string[a:b].lower())
            if match1:
                authentication = "Not required (Authentication is not required to exploit the vulnerability.)"
            elif match2:
                authentication = "Required (Authentication is required to exploit the vulnerability.)"
            else:
                print("\nCould not append Authentication from cvedetails site for the following issue: " + issue_title)
                authentication = "Not required (Authentication is not required to exploit the vulnerability.)"
        else:
            print("\nCould not append Authentication from cvedetails site for the following issue: " + issue_title)

        return authentication

    def appendGainedAccess(self, newCveSite, issuetitle):
        issue_title = issuetitle
        access = ''
        accessFieldPattern = re.compile(r'Gained Access</th>')
        accessNone = re.compile(r'none')
        accessPartial = re.compile(r'partial')
        accessComplete = re.compile(r'complete')

        # Getting Gained Access field from cvssdetails website via generic HTTP GET request
        req = requests.get(newCveSite)

        # Converting response body into a string
        responseBody = str(req.text)

        # Searching response body (string version)
        fieldMatch = re.search(accessFieldPattern, responseBody)
        if fieldMatch:
            a = fieldMatch.end()
            b = fieldMatch.end() + 50
            match1 = re.search(accessNone, fieldMatch.string[a:b].lower())
            match2 = re.search(accessPartial, fieldMatch.string[a:b].lower())
            match3 = re.search(accessComplete, fieldMatch.string[a:b].lower())
            if match1:
                access = "None"
            elif match2:
                access = "Partial"
            elif match3:
                access = "Complete"
            else:
                access = "N/A"
        else:
            print("\nCould not append Gained Access from cvedetails site for the following issue: " + issue_title)

        return access

    def appendVulnType(self, newCveSite, issuetitle):
        issue_title = issuetitle
        vulnType = ''
        vu = ''
        vudu = ''
        vulnTypeFieldPattern = re.compile(r'Vulnerability Type\([^()]*\)')
        vuln = re.compile(r'\">[^()]*\</')

        # Getting Vulnerability Type field from cvssdetails website via generic HTTP GET request
        req = requests.get(newCveSite)

        # Converting response body into a string
        responseBody = str(req.text)

        # Searching response body (string version)
        fieldMatch = re.search(vulnTypeFieldPattern, responseBody)
        if fieldMatch:
            a = fieldMatch.end()
            b = fieldMatch.end() + 90
            match1 = re.search(vuln, fieldMatch.string[a:b])
            if match1:
                x = match1.start()
                y = match1.end()
                #print("\nVULN VALUE MATCH: \n" + match1.string[match1.start():match1.end()] + "\n")
                vulnType = match1.string[x+1:y-8]
            else:
                print("\nCould not append Vulnerability Type from cvedetails site for the following issue: " + issue_title)
                vulnType = "N/A"
        else:
            print("\nCould not append Vulnerability Type from cvedetails site for the following issue: " + issue_title)

        vu = re.sub('([^\s\w]|_)+', '', vulnType)
        vudu = vu.replace('span','')
        return vudu

    def calculateRisk(self, imp, ez):
        impact = imp
        ease = ez
        risk = ""
        if (impact.lower() == "high" and ease.lower() == "high") or (impact.lower() == "high" and ease.lower() == "moderate") or (impact.lower() == "high" and ease.lower() == "medium"):
            risk = "High"
        elif impact.lower() == "high" and ease.lower() == "low":
            risk = "Moderate"
        elif (impact.lower() == "moderate" and ease.lower() == "high") or (impact.lower() == "moderate" and ease.lower() == "moderate") or (impact.lower() == "moderate" and ease.lower() == "medium"):
            risk = "Moderate"
        elif impact.lower() == "moderate" and ease.lower() == "low":
            risk = "Low"
        elif impact.lower() == "low" and ease.lower() == "high":
            risk = "Moderate"
        elif (impact.lower() == "low" and ease.lower() == "moderate") or (impact.lower() == "low" and ease.lower() == "low"):
            risk = "Low"
        return risk

    def appendCweNum(self, newCveSite):
        cweNum = ''
        pattern1 = re.compile(r'CWE-[0-9][0-9]')
        pattern2 = re.compile(r'CWE-[0-9][0-9][0-9]')
        pattern3 = re.compile(r'CWE-[0-9][0-9][0-9][0-9]')
        # Getting CWE ID from cvedetails website via generic HTTP GET request
        cweReq = requests.get(newCveSite)

        # Converting response body into a string
        responseBody = str(cweReq.text)

        # Searching response body (string version) to see if it has a two, three, or four digit CWE number
        # No CVEs are associated with a one digit CWE number on cvedetails so it is currently excluded
        match1 = re.search(pattern1, responseBody)
        match2 = re.search(pattern2, responseBody)
        match3 = re.search(pattern3, responseBody)
        if match1:
            s = match1.start()
            e = match1.end()
            cweNum = match1.string[s:e]
        elif match2:
            s = match2.start()
            e = match2.end()
            cweNum = match2.string[s:e]
        elif match3:
            s = match3.start()
            e = match3.end()
            cweNum = match3.string[s:e]
        else:
            cweNum = ""

        return cweNum

    def refCveAlreadyExists(self, issuetitle, cvePattern1, cvePattern2, cvePattern3, field):
        issue_title = issuetitle
        cveNum = ''
        cveList = []
        cveMatch1 = re.findall(cvePattern1, field)  # If the CVE number is in this format: CVE-xxxx-xxxx
        cveMatch2 = re.findall(cvePattern2, field)  # If the CVE number is in this format: CVE-xxxx-xxxxx
        cveMatch3 = re.findall(cvePattern3, field)  # If the CVE number is in this format: CVE-xxxx-xxxxxx
        if cveMatch1:
            print("\nFound at least one CVE number in References section of " + issue_title)
            for item in cveMatch1:
                cveList.append(item)
        elif cveMatch2:
            for item in cveMatch2:
                cveList.append(item)
        elif cveMatch3:
            for item in cveMatch3:
                cveList.append(item)
        else:
            print("\nFound no CVE numbers in References section of " + issue_title)

        return cveList

    def refUrlAlreadyExists(self, issuetitle, cvePattern1, cvePattern2, cvePattern3, field):
        newCveSite = 'https://cvedetails.com/cve/'
        issue_title = issuetitle
        cveDetailsMatch1 = re.findall(cvePattern1, field)
        cveDetailsMatch2 = re.findall(cvePattern2, field)
        cveDetailsMatch3 = re.findall(cvePattern3, field)
        cveSiteList = []
        if cveDetailsMatch1:
            print("\nFound a quad digit cvedetails link in References section of issue " + issue_title)
            for item in cveDetailsMatch1:
                cveSiteList.append(newCveSite + item)
        elif cveDetailsMatch2:
            print("\nFound a five digit cvedetails link in References section of issue " + issue_title)
            for item in cveDetailsMatch2:
                cveSiteList.append(newCveSite + item)
        elif cveDetailsMatch3:
            print("\nFound a six digit cvedetails link in References section of issue " + issue_title)
            for item in cveDetailsMatch3:
                cveSiteList.append(newCveSite + item)
        else:
            print("\nFound no cvedetails links in References section of " + issue_title)

        return cveSiteList

    def cvedetailsUrl(self, issuetitle, cveList, cvePattern1, cvePattern2, cvePattern3, field):  # This is called if a CVE number is found but no cvedetails link
        newCveSite = 'https://cvedetails.com/cve/'
        issue_title = issuetitle
        cveSiteList = []
        for item in cveList:
            cveSiteList.append(newCveSite + item)

        return cveSiteList

    def appendCveNum(self):
        # Add CVE number to the CVE_ID and References field of every issue in Dradis
        today = str(datetime.datetime.now())
        newCveSite = 'https://cvedetails.com/cve/'
        cvePattern1 = re.compile(r'CVE-[0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9]')
        cvePattern2 = re.compile(r'CVE-[0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9][0-9]')
        cvePattern3 = re.compile(r'CVE-[0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9][0-9][0-9]')
        refPattern = re.compile(r'References')
        cvePattern = re.compile(r'CVE_ID')
        cwePattern = re.compile(r'CWE_ID')
        pattern1 = re.compile(r'CWE-[0-9][0-9]')
        pattern2 = re.compile(r'CWE-[0-9][0-9][0-9]')
        pattern3 = re.compile(r'CWE-[0-9][0-9][0-9][0-9]')
        modulePattern = re.compile(r'Module_OTGv4')
        touchedByPattern = re.compile(r'Touched_By')
        cvssPattern = re.compile(r'\d+\.\d+')
        numIssues = 0
        numHighs = 0
        numMeds = 0
        numLows = 0
        # HTTP GET request headers
        headers = {'Authorization': 'Token token={0}'.format(self.dradis_api_token), 'Dradis-Project-Id': self.dradis_project_id}

		# HTTP PUT/POST request headers
        putHeaders = {'Authorization': 'Token token={0}'.format(self.dradis_api_token), 'Dradis-Project-Id': self.dradis_project_id, 'Content-Type':'application/json'}

        # HTTP DELETE request headers
        delHeaders = {'Authorization': 'Token token={0}'.format(self.dradis_api_token), 'Dradis-Project-Id': self.dradis_project_id, 'Content-Type':'application/json'}

        # HTTP GET request to get all issues in the specified Dradis project
        response = self.session.get(self.dradis_issues_url, headers=headers, verify=self.verify_cert)

        # If the above GET request returns 200 code, let the user know, otherwise say what's wrong
        if '[200]' in str(response):
            print('HTTP 200 OK')
        else:
            print('Did not receive HTTP 200 code, probably incorrect Dradis url argument. ' + str(response))
        
        # Convert the GET response into a JSON object which will be interpreted by Python as a dict, lovely
        issues = response.json()
        
        # Print the response body (all issues in Dradis) to show that it works (hopefully)
        #print(issues)

        # Loop over every primary issue (highest level JSON object) in the dict containing all Dradis issues
        for issue in issues:
            # Loop over every field and value within each Dradis issue
            numIssues = numIssues + 1
            issueTitle = ''
            issueImpact = ''
            issueEase = ''
            issueRisk = ''
            issueConfidentiality = ''
            issueIntegrity = ''
            issueAvailability = ''
            issueComplexity = ''
            issueCvss = ''
            issueAuthentication = ''
            issueSummary = ''
            issueInsight = ''
            issueMitigation = ''
            issueRiskStatus = ''
            issueThreatAgent = ''
            issueGainedAccess = ''
            issueVulnType = ''
            issueTouchedBy = ''
            issueCveId = ''
            issueCweId = ''
            issueModules = ''
            impact = ''
            impactList = []
            confidentiality = ''
            confidentialityList = []
            integrity = ''
            integrityList = []
            availability = ''
            availabilityList = []
            complexity = ''
            complexityList = []
            ease = ''
            easeList = []
            authentication = ''
            authenticationList = []
            threatAgent = ''
            gainedAccess = ''
            gainedAccessList = []
            vulnType = ''
            vulnTypeList = []
            risk = ''
            cveNum = ''
            cweNum = ''
            cweList = []
            cvss = 0.0
            cvssList = []
            cvssExists = False  # Does the issue already have a CVSS score?
            cweField = '\r\n#[CWE_ID]#\r\n'
            cveField = '\r\n#[CVE_ID]#\r\n'
            vs = re.compile(r'\w')
            cveFieldExists = False  # Does the CVE_ID issue field exist in the issue?
            cweFieldExists = False  # Does the CWE_ID issue field exist in the issue?
            cveExists = False  # Is there a CVE number in the References section?
            cweExists = False  # Is there a CWE ID?
            refExists = False  # Is there already a cvedetails website in References?
            refContainer = ''
            issueText = ''
            frankenstein = ''
            cveList = []
            cveSiteList = []
            endOfIssue = 0
            realEndOfIssue = 0
            for key, value in issue.items():
                # Code to find issue ID, which is used to identify the issue and is used in the PUT URL, very important
                if key == 'id':
                    issue_id = str(issue[key])
                    dradis_issue_url = self.dradis_issues_url + '/' + issue_id

                # Storing current issue title, for debugging
                if key == 'title':
                    issue_title = str(issue[key])
                    issueTitle = "#[Title]#\r\n" + issue_title + "\r\n\r\n"
                #print('KEY: ' + str(key) + ' VALUE: ' + str(value))  # Listing every issue field and value just to show that it is working

                # Appending the entirety of the current issue into a string variable
                if key == 'text':
                    issueText = str(issue[key])
                    realEndOfIssue = len(issueText)
                    myEnd = re.search(modulePattern, issue[key])
                    touchMe = re.search(touchedByPattern, issue[key])
                    if not touchMe:
                        if myEnd:
                            x = myEnd.start() - 2
                            y = myEnd.end() + 2
                            endOfIssue = len(issueText) - x
                            issueModules = myEnd.string[x:]
                        else:
                            issueModules = "#[Module_OTGv4]#\r\n\r\n#[Module_PCIDSS32]#\r\n\r\n#[Module_HIPAA]#\r\n\r\n#[Module_NIST53]#\r\n\r\n#[Module_ISO27K2013]#\r\n\r\n#[Module_GDPR2016]#\r\n\r\n#[Touched_By]#\r\nCVE_Bot_" + today + "\r\n\r\n"
                    else:
                        a = touchMe.start() - 2
                        b = touchMe.end() + 2
                        if myEnd:
                            y = myEnd.start() - 2
                            z = myEnd.end() + 2
                            issueModules = myEnd.string[y:a]
                        else:
                            issueModules = "#[Module_OTGv4]#\r\n\r\n#[Module_PCIDSS32]#\r\n\r\n#[Module_HIPAA]#\r\n\r\n#[Module_NIST53]#\r\n\r\n#[Module_ISO27K2013]#\r\n\r\n#[Module_GDPR2016]#\r\n\r\n"

                # 'Fields' is a JSON parameter that contains its own JSON parameters, so it is its own dict. Loop over it to dig inside each issue.
                if key == 'fields':
                    fields = value
                    #print('\nFIELDS: ' + str(fields) + '\n\n')  # Debug output
                    # Operation to carry out if CVE_ID and CWE_ID fields do not exist
                    if 'CVE_ID' not in fields.keys() and 'CWE_ID' not in fields.keys():
                        # Looping over every key and value of the fields dict
                        for cey, falue in fields.items():
                            #print('CEY: ' + str(cey) + ' FALUE: ' + str(falue) + '\n\n')  # Debug output
                            if cey == 'Impact':
                                issueImpact = "#[Impact]#\r\n" + fields[cey] + "\r\n\r\n"
                                impact = fields[cey]

                            if cey == 'Ease':
                                issueEase = "#[Ease]#\r\n" + fields[cey] + "\r\n\r\n"
                                ease = fields[cey]

                            if cey == 'Confidentiality_Impact':
                                issueConfidentiality = "#[Confidentiality_Impact]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Integrity_Impact':
                                issueIntegrity = "#[Integrity_Impact]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Availability_Impact':
                                issueAvailability = "#[Availability_Impact]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Access_Complexity':
                                issueComplexity = "#[Access_Complexity]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Risk':
                                issueRisk = "#[Risk]#\r\n" + fields[cey] + "\r\n\r\n"
                                risk = fields[cey]
                                if "high" not in fields[cey].lower() and "moderate" not in fields[cey].lower() and "medium" not in fields[cey].lower() and "low" not in fields[cey].lower():
                                    issueRisk = "#[Risk]#\r\n" + self.calculateRisk(impact, ease) + "\r\n\r\n"
                                if "high" in fields[cey].lower():
                                    numHighs = numHighs + 1
                                elif "moderate" in fields[cey].lower() or "medium" in fields[cey].lower():
                                    numMeds = numMeds + 1
                                elif "low" in fields[cey].lower():
                                    numLows = numLows + 1

                            if cey == 'Authentication':
                                issueAuthentication = "#[Authentication]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Summary':
                                issueSummary = "#[Summary]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Insight':
                                issueInsight = "#[Insight]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Mitigation':
                                issueMitigation = "#[Mitigation]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Risk_Status':
                                issueRiskStatus = "#[Risk_Status]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Threat_Agent':
                                issueThreatAgent = "#[Threat_Agent]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Gained_Access':
                                issueGainedAccess = "#[Gained_Access]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Vulnerability_Type':
                                issueVulnType = "#[Vulnerability_Type]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'References':
                                issueReferences = "#[References]#\r\n" + fields[cey] + "\r\n\r\n"
                                # If there is already a CVE number in the References issue field, use that
                                if ('CVE-' in issueReferences.upper() or 'cve-' in issueReferences) and 'cvedetails' not in issueReferences.lower():  # Crudely verifying that there is a CVE number in the References field
                                    print("\nFound a CVE ID but no cvedetails link in References section\n")
                                    cveList = self.refCveAlreadyExists(issue_title, cvePattern1, cvePattern2, cvePattern3, issueReferences)
                                    cveSiteList = self.cvedetailsUrl(issue_title, cveList, cvePattern1, cvePattern2, cvePattern3, issueReferences.lower())
                                    cveExists = True
                                    issueReferences = "#[References]#\r\n"
                                    for item in cveSiteList:
                                        issueReferences += item + "\r\n"
                                    issueReferences += fields[cey] + "\r\n\r\n"
                                    issueCveId = "#[CVE_ID]#\r\n"
                                    for item in cveList:
                                        issueCveId += item + "\r\n"
                                    issueCveId += "\r\n"
                                # If a cvedetails website is in the References section already
                                elif 'cvedetails' in issueReferences.lower():
                                    cveSiteList = self.refUrlAlreadyExists(issue_title, cvePattern1, cvePattern2, cvePattern3, issueReferences)
                                    cveExists = True
                                    refExists = True
                                    cveList = self.refCveAlreadyExists(issue_title, cvePattern1, cvePattern2, cvePattern3, issueReferences)
                                    issueCveId = "#[CVE_ID]#\r\n"
                                    for item in cveList:
                                        issueCveId += item + "\r\n"
                                    issueCveId += "\r\n\r\n"
                                else:
                                    print("\nFound no CVE data in References section\n")
                                    issueCveId = "#[CVE_ID]#\r\n\r\n"

                            # Getting CVSS score, will check to see if it's already in the issue first
                            if cey == 'CVSS':
                                issueCvss = "#[CVSS]#\r\n" + fields[cey] + "\r\n\r\n"
                                cvssMatch1 = re.search(cvssPattern, issueCvss)
                                if cvssMatch1:
                                    cvssExists = True
                                    s = cvssMatch1.start()
                                    e = cvssMatch1.end()
                                    cvss = float(cvssMatch1.string[s:e])

                            # Getting CWE ID from cvedetails website via generic HTTP GET request
                            for item in cveSiteList:
                                cweList.append(self.appendCweNum(item))
                            issueCweId = "#[CWE_ID]#\r\n"
                            for item in cweList:
                                issueCweId += item + "\r\n"
                            issueCweId += "\r\n\r\n"

                            if cey == 'Touched_By':
                                issueTouchedBy = "\r\n#[Touched_By]#\r\n" + fields[cey] + "\r\nCVE_Bot_" + today + "\r\n\r\n"
                    # Operation to carry out if CVE_ID and/or CWE_ID fields already exist in the issue
                    else:
                        for cey, falue in fields.items():
                            if cey == 'Impact':
                                issueImpact = "#[Impact]#\r\n" + fields[cey] + "\r\n\r\n"
                                impact = fields[cey]

                            if cey == 'Ease':
                                issueEase = "#[Ease]#\r\n" + fields[cey] + "\r\n\r\n"
                                ease = fields[cey]

                            if cey == 'Confidentiality_Impact':
                                issueConfidentiality = "#[Confidentiality_Impact]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Integrity_Impact':
                                issueIntegrity = "#[Integrity_Impact]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Availability_Impact':
                                issueAvailability = "#[Availability_Impact]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Access_Complexity':
                                issueComplexity = "#[Access_Complexity]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Risk':
                                issueRisk = "#[Risk]#\r\n" + fields[cey] + "\r\n\r\n"
                                risk = fields[cey]
                                if "high" not in fields[cey].lower() and "moderate" not in fields[cey].lower() and "medium" not in fields[cey].lower() and "low" not in fields[cey].lower():
                                    issueRisk = "#[Risk]#\r\n" + self.calculateRisk(impact, ease) + "\r\n\r\n"

                            if cey == 'Authentication':
                                issueAuthentication = "#[Authentication]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Summary':
                                issueSummary = "#[Summary]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Insight':
                                issueInsight = "#[Insight]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Mitigation':
                                issueMitigation = "#[Mitigation]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Risk_Status':
                                issueRiskStatus = "#[Risk_Status]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Threat_Agent':
                                issueThreatAgent = "#[Threat_Agent]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Gained_Access':
                                issueGainedAccess = "#[Gained_Access]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'Vulnerability_Type':
                                issueVulnType = "#[Vulnerability_Type]#\r\n" + fields[cey] + "\r\n\r\n"

                            if cey == 'References':
                                issueReferences = "#[References]#\r\n" + fields[cey] + "\r\n\r\n"
                                refContainer = fields[cey]
                                # If there is already a CVE number in the References issue field, use that
                                if ('CVE-' in issueReferences.upper() or 'cve-' in issueReferences) and 'cvedetails' not in issueReferences.lower():  # Crudely verifying that there is a CVE number in the References field
                                    print("\nFound a CVE ID but no cvedetails link in References section\n")
                                    cveList = self.refCveAlreadyExists(issue_title, cvePattern1, cvePattern2, cvePattern3, issueReferences)
                                    cveSiteList = self.cvedetailsUrl(issue_title, cveList, cvePattern1, cvePattern2, cvePattern3, issueReferences.lower())
                                    cveExists = True
                                    issueReferences = "#[References]#\r\n"  
                                    for item in cveSiteList:
                                        issueReferences += item + "\r\n"
                                    issueReferences += fields[cey] + "\r\n\r\n"
                                    issueCveId = "#[CVE_ID]#\r\n"
                                    for item in cveList:
                                        issueCveId += item + "\r\n"
                                    issueCveId += "\r\n\r\n"
                                # If a cvedetails website is in the References section already
                                elif 'cvedetails' in issueReferences.lower():
                                    cveSiteList = self.refUrlAlreadyExists(issue_title, cvePattern1, cvePattern2, cvePattern3, issueReferences)
                                    cveExists = True
                                    refExists = True
                                    cveList = self.refCveAlreadyExists(issue_title, cvePattern1, cvePattern2, cvePattern3, issueReferences)
                                    issueCveId = "#[CVE_ID]#\r\n"
                                    for item in cveList:
                                        issueCveId += item + "\r\n"
                                    issueCveId += "\r\n"
                                else:
                                    print("\nFound no CVE data in References section\n")
                                    issueCveId = "#[CVE_ID]#\r\n\r\n"

                            # Getting CVSS score, will check to see if it's already in the issue first
                            if cey == 'CVSS':
                                issueCvss = "#[CVSS]#\r\n" + fields[cey] + "\r\n\r\n"
                                cvssMatch1 = re.search(cvssPattern, issueCvss)
                                if cvssMatch1:
                                    cvssExists = True
                                    s = cvssMatch1.start()
                                    e = cvssMatch1.end()
                                    cvss = float(cvssMatch1.string[s:e])

                            # Checking to see if a CVE_ID field already exists, must edit cveNum to not include Dradis code
                            if cey == 'CVE_ID':
                                cveFieldExists = True
                                if 'CVE-' in fields[cey].upper() or 'cve-' in fields[cey]:  #Crudely verifying that there is a CVE number in the CVE_ID field
                                    issueCveId = "#[CVE_ID]#\r\n" + fields[cey] + "\r\n\r\n"
                                    cveExists = True
                                    cveMatch1 = re.findall(cvePattern1, fields[cey])  # If the CVE number is in this format: CVE-xxxx-xxxx
                                    cveMatch2 = re.findall(cvePattern2, fields[cey])  # If the CVE number is in this format: CVE-xxxx-xxxxx
                                    cveMatch3 = re.findall(cvePattern3, fields[cey])  # If the CVE number is in this format: CVE-xxxx-xxxxxx
                                    if cveMatch1:
                                        for item in cveMatch1:
                                            cveList.append(item)
                                    elif cveMatch2:
                                        for item in cveMatch2:
                                            cveList.append(item)
                                    elif cveMatch3:
                                        for item in cveMatch3:
                                            cveList.append(item)

                                    # If there is no cvedetails link in References section (we already know this by now), make one now
                                    if refExists == False:
                                        issueReferences = "#[References]#\r\n"  
                                        for item in cveList:
                                            issueReferences += newCveSite + item + "\r\n"
                                        issueReferences += refContainer + "\r\n\r\n"
                                else:
                                    print("Found a CVE_ID field with no CVE number in it, in issue #" + issue_id + " " + issue_title + ", skipping...")
                                    cveNum = 'N/A'

                            # Checking to see if a CWE_ID field already exists
                            if cey == 'CWE_ID':
                                cweFieldExists = True
                                if 'CWE-' in fields[cey].upper() or 'cwe-' in fields[cey]:
                                    issueCweId = "#[CWE_ID]#\r\n" + fields[cey] + "\r\n\r\n"
                                    cweMatch1 = re.search(pattern1, fields[cey])
                                    cweMatch2 = re.search(pattern2, fields[cey])
                                    cweMatch3 = re.search(pattern3, fields[cey])
                                    if cweMatch1:
                                        cweExists = True
                                        s = cweMatch1.start()
                                        e = cweMatch1.end()
                                        cweNum = cweMatch1.string[s:e]
                                        cweList.append(cweNum)
                                    elif cweMatch2:
                                        cweExists = True
                                        s = cweMatch2.start()
                                        e = cweMatch2.end()
                                        cweNum = cweMatch2.string[s:e]
                                        cweList.append(cweNum)
                                    elif cweMatch3:
                                        cweExists = True
                                        s = cweMatch3.start()
                                        e = cweMatch3.end()
                                        cweNum = cweMatch3.string[s:e]
                                        cweList.append(cweNum)
                                else:
                                    cweExists = True
                                    for item in cveSiteList:
                                        cweList.append(self.appendCweNum(item))
                                    issueCweId = "#[CWE_ID]#\r\n" 
                                    for item in cweList:
                                        issueCweId += item + "\r\n"
                                    issueCweId += "\r\n\r\n"

                            if cey == 'Touched_By':
                                issueTouchedBy = "\r\n#[Touched_By]#\r\n" + fields[cey] + "\r\nCVE_Bot_" + today + "\r\n\r\n"

            if "high" not in impact.lower() and "moderate" not in impact.lower() and "medium" not in impact.lower() and "low" not in impact.lower():
                for item in cveSiteList:
                    impactList.append(self.appendImpact(item, issue_title))
                for item in impactList:
                    if "complete" in str(item).lower():
                        impact = "High"
                    elif "partial" in str(item).lower():
                        impact = "Moderate"
                    elif "none" in str(item).lower():
                        impact = "Low"
                    else:
                        print("\nImpact retest FAILED!!!\n")
                        impact = "N/A"
                issueImpact = "#[Impact]#\r\n" + impact + "\r\n\r\n"

            if "high" not in ease.lower() and "moderate" not in ease.lower() and "medium" not in ease.lower() and "low" not in ease.lower():
                for item in cveSiteList:
                    easeList.append(self.appendComplexity(item, issue_title))
                for item in easeList:
                    if "high" in str(item).lower():
                        ease = "Low"
                    elif "medium" in str(item).lower():
                        ease = "Moderate"
                    elif "low" in str(item).lower():
                        ease = "Low"
                    else:
                        print("\nEase retest FAILED!!!\n")
                        ease = "N/A"
                issueEase = "#[Ease]#\r\n" + ease + "\r\n\r\n"

            if "complete" not in issueConfidentiality.lower() and "partial" not in issueConfidentiality.lower() and "none" not in issueConfidentiality.lower():
                for item in cveSiteList:
                    confidentialityList.append(self.appendImpact(item, issue_title))
                for item in confidentialityList:
                    if "complete" in str(item).lower():
                        confidentiality = "Complete (There is total information disclosure, resulting in all system files being revealed.)"
                    elif "partial" in str(item).lower():
                        confidentiality = "Partial (There is considerable informational disclosure.)"
                    elif "none" in str(item).lower():
                        confidentiality = "None (There is no impact to the confidentiality of the system.)"
                issueConfidentiality = "#[Confidentiality_Impact]#\r\n" + confidentiality + "\r\n\r\n"

            if "complete" not in issueIntegrity.lower() and "partial" not in issueIntegrity.lower() and "none" not in issueIntegrity.lower():
                for item in cveSiteList:
                    integrityList.append(self.appendIntegrity(item, issue_title))
                for item in integrityList:
                    if "complete" in str(item).lower():
                        integrity = "Complete (There is a total compromise of system integrity. There is a complete loss of system protection, resulting in the entire system being compromised.)"
                    elif "partial" in str(item).lower():
                        integrity = "Partial (Modification of some system files or information is possible, but the attacker does not have control over what can be modified, or the scope of what the attacker can affect is limited.)"
                    elif "none" in str(item).lower():
                        integrity = "None (There is no impact to the integrity of the system.)"
                    else:
                        print("\nIntegrity Impact retest FAILED!!!\n")
                        integrity = "N/A"
                issueIntegrity = "#[Integrity_Impact]#\r\n" + integrity + "\r\n\r\n"

            if "complete" not in issueAvailability.lower() and "partial" not in issueAvailability.lower() and "none" not in issueAvailability.lower():
                for item in cveSiteList:
                    availabilityList.append(self.appendAvailability(item, issue_title))
                for item in availabilityList:
                    if "complete" in str(item).lower():
                        availability = "Complete (There is a total shutdown of the affected resource. The attacker can render the resource completely unavailable.)"
                    elif "partial" in str(item).lower():
                        availability = "Partial (There is reduced performance or interruptions in resource availability.)"
                    elif "none" in str(item).lower():
                        availability = "None (There is no impact to the availability of the system.)"
                    else:
                        print("\nAvailability Impact retest FAILED!!!\n")
                        availability = "N/A"
                issueAvailability = "#[Availability_Impact]#\r\n" + availability + "\r\n\r\n"

            if "high" not in issueComplexity.lower() and "medium" not in issueComplexity.lower() and "low" not in issueComplexity.lower():
                for item in cveSiteList:
                    complexityList.append(self.appendComplexity(item, issue_title))
                for item in complexityList:
                    if "low" in str(item).lower():
                        complexity = "Low (Specialized access conditions or extenuating circumstances do not exist. Very little knowledge or skill is required to exploit.)"
                    elif "medium" in str(item).lower():
                        complexity = "Medium (The access conditions are somewhat specialized. Some preconditions must be satisfied to exploit.)"
                    elif "high" in str(item).lower():
                        complexity = "High (Specialized access conditions exist. It is hard to exploit and several special conditions must be satisfied to exploit.)"
                    else:
                        print("\nAccess Complexity retest FAILED!!!\n")
                        complexity = "N/A"
                issueComplexity = "#[Access_Complexity]#\r\n" + complexity + "\r\n\r\n"

            if "Risk" not in issueRisk:
                issueRisk = "#[Risk]#\r\n\r\n"

            if "high" not in risk.lower() and "moderate" not in risk.lower() and "medium" not in risk.lower() and "low" not in risk.lower():
                issueRisk = "#[Risk]#\r\n" + self.calculateRisk(impact, ease) + "\r\n\r\n"

            if "required" not in issueAuthentication.lower():
                for item in cveSiteList:
                    authenticationList.append(self.appendAuthentication(item, issue_title))
                for item in authenticationList:
                    if "not required" in str(item).lower():
                        authentication = "Not required (Authentication is not required to exploit the vulnerability.)"
                    elif "required" in str(item).lower():
                        authentication = "Required (Authentication is required to exploit the vulnerability.)"
                    else:
                        print("\nAuthentication retest FAILED!!!\n")
                        authentication = "Not required (Authentication is not required to exploit the vulnerability.)"
                issueAuthentication = "#[Authentication]#\r\n" + authentication + "\r\n\r\n"

            if "complete" not in issueGainedAccess.lower() and "partial" not in issueGainedAccess.lower() and "none" not in issueGainedAccess.lower():
                for item in cveSiteList:
                    gainedAccessList.append(self.appendGainedAccess(item, issue_title))
                for item in gainedAccessList:
                    if "complete" in str(item).lower():
                        gainedAccess = "Complete"
                    elif "partial" in str(item).lower():
                        gainedAccess = "Partial"
                    elif "none" in str(item).lower():
                        gainedAccess = "None"
                    else:
                        print("\nGained Access retest FAILED!!!\n")
                        gainedAccess = "None"
                issueGainedAccess = "#[Gained_Access]#\r\n" + gainedAccess + "\r\n\r\n"

            test = re.search(vs, issueVulnType)
            if not test:
                issueVulnType = "#[Vulnerability_Type]#\r\n"
                for item in cveSiteList:
                    vulnTypeList.append(self.appendVulnType(item, issue_title))
                for item in vulnTypeList:
                    issueVulnType += item
                issueVulnType += "\r\n\r\n"

            for item in cveSiteList:
                cvssList.append(self.appendCvss(item, issue_title))
                cvss = max(cvssList)
                issueCvss = "#[CVSS]#\r\n" + str(cvss) + "\r\n\r\n"

            print("\nCVSS: " + str(cvss) + "\nImpact: " + impact + "\nConfidentiality Impact: " + confidentiality + "\nIntegrity Impact: " + integrity + "\nAvailability Impact: " + availability + "\nAccess Complexity: " + complexity + "\nEase: " + ease + "\nAuthentication: " + authentication + "\nGained Access: " + gainedAccess + "\nVulnerability Type(s): " + str(vulnTypeList) + "\n")
            '''print("\nTime to change things up\n")
            cvss = self.appendCvss("https://www.cvedetails.com/cve/CVE-2011-3556", issue_title)
            impact = self.appendImpact("https://www.cvedetails.com/cve/CVE-2011-3556", issue_title)
            confidentiality = self.appendImpact("https://www.cvedetails.com/cve/CVE-2011-3556", issue_title)
            integrity = self.appendIntegrity("https://www.cvedetails.com/cve/CVE-2011-3556", issue_title)
            availability = self.appendAvailability("https://www.cvedetails.com/cve/CVE-2011-3556", issue_title)
            complexity = self.appendComplexity("https://www.cvedetails.com/cve/CVE-2011-3556", issue_title)
            gainedAccess = self.appendGainedAccess("https://www.cvedetails.com/cve/CVE-2011-3556", issue_title)
            authentication = self.appendAuthentication("https://www.cvedetails.com/cve/CVE-2011-3556", issue_title)
            print("\n\nREVISED LIST:\nCVSS: " + str(cvss) + "\nImpact: " + impact + "\nConfidentiality Impact: " + confidentiality + "\nIntegrity Impact: " + integrity + "\nAvailability Impact: " + availability + "\nAccess Complexity: " + complexity + "\nEase: " + ease + "\nAuthentication: " + authentication + "\nGained Access: " + gainedAccess + "\n")'''
            frankenstein = issueTitle + issueImpact + issueConfidentiality + issueIntegrity + issueAvailability + issueComplexity + issueEase + issueRisk + issueAuthentication + issueCvss + issueSummary + issueInsight + issueMitigation + issueRiskStatus + issueThreatAgent + issueGainedAccess + issueVulnType + issueReferences + issueCveId + issueCweId + issueModules + issueTouchedBy

            # DELETE THE ISSUE
            delete = requests.delete(dradis_issue_url, headers=delHeaders, verify=self.verify_cert)
            if delete.status_code == 204:
                print("Successfully removed the following issue: " + issue_title)
            else:
                print("Failed renovating the following issue: \n\n{1}\nStatus Code: {2}\n\n".format(delete.status_code, delete.text))

            # This is the only way to do PUT or POST requests with Dradis API
            issue_data = {'issue': {"text": frankenstein}}

            # The almighty HTTP POST request to recreate issues
            dradis = requests.post(dradis_issue_url, data=dumps(issue_data), headers=putHeaders, verify=self.verify_cert)
            if dradis.status_code == 201:
                print("Successfully reuploaded the following issue: " + issue_title)
            else:
                print("Failed renovating the following issue: \n\n{1}\nStatus Code: {2}\n\n".format(dradis.status_code, dradis.text))
        print("\nThere are {0} issues in this project\n".format(numIssues))
        nodeBuster(self, numIssues, numHighs, numMeds, numLows)
        return

    def nodeBuster(self, a, b, c, d):
        numIssues = a
        numHighs = b
        numMeds = c
        numLows = d
        # HTTP GET request headers
        headers = {'Authorization': 'Token token={0}'.format(self.dradis_api_token), 'Dradis-Project-Id': self.dradis_project_id}

        # HTTP GET request to get all issues in the specified Dradis project
        response = self.session.get(self.dradis_nodes_url, headers=headers, verify=self.verify_cert)

        # If the above GET request returns 200 code, let the user know, otherwise say what's wrong
        if '[200]' in str(response):
            print('HTTP 200 OK')
        else:
            print('Did not receive HTTP 200 code, probably incorrect Dradis url argument. ' + str(response))

        # Convert the GET response into a JSON object which will be interpreted by Python as a dict, lovely
        nodes = response.json()
        
        for node in nodes:
            host = ""
            ip = ""
            os = ""
            locality = ""
            for key, value in node.items():
                if key == "notes":
                    fields = value
                    for item in fields:
                        #print(str(item) + "\n")
                        for cey, falue in item.items():
                            if cey == "fields":
                                stuff = falue
                                for a, b in stuff.items():
                                    #print(str(a) + ": " + str(b) + "\n")
                                    if a == "Host" or a == "IP":
                                        ip = b.replace(",","")
                                    if a == "Hostnames":
                                        host = b.replace(",","")
                                    if a == "OS":
                                        os = b.replace(",","")
            if "10." in ip or "172.16" in ip or "172.17" in ip or "172.18" in ip or "172.19" in ip or "172.20" in ip or "172.21" in ip or "172.22" in ip or "172.23" in ip or "172.24" in ip or "172.25" in ip or "172.26" in ip or "172.27" in ip or "172.28" in ip or "172.29" in ip or "172.30" in ip or "172.31" in ip or "172.32" in ip:
                locality = "Internal"
            else:
                locality = "External"
            print(host + "," + ip + "," + os + "," + locality + "\n")
        return

    @staticmethod
    def parse_args():
        # parse the arguments
        parser = ArgumentParser(epilog='\tExample: \r\npython ' + argv[0] +
                                       " https://dradis.govanguard.co/ 21 xa632ghas87d393287",
                                description="Automatically add CVE number to all Dradis issues")
        parser.add_argument('dradis_url', help="Dradis URL")
        parser.add_argument('dradis_project_id', help="Dradis Project ID")
        parser.add_argument('dradis_api_token', help="Dradis API token")
        return parser.parse_args()

if __name__ == "__main__":
    start_time = time.time()
    c = cveScript()
    c.run()
    print("\n\n%s seconds" % (time.time() - start_time))